<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Yoson Ling">





<title>关于 UniRLTest | Yoson&#39;s Blog</title>



    <link rel="icon" href="/FisherGirl.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Yoson&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Yoson&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">关于 UniRLTest</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Yoson Ling</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">八月 3, 2022&nbsp;&nbsp;11:04:16</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Project/">Project</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>有幸能参与到实验室学长的一个项目当中，简单记录一下整个项目和一些收获</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><em>UniRLTest</em> 即 <em>Universal Reinforcement Learning Test</em>，是基于图像识别、深度强化学习等实现的跨平台软件测试工具</p>
<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>前端部分主要负责与后端和设备进行通讯，接收后端传来的操作指令并在设备上执行，获取设备上应用的屏幕截图并传给后端进行分析</p>
<p>文件大致结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">../urt/urt-frontend</span><br><span class="line">│  client.py</span><br><span class="line">│  launcher.py</span><br><span class="line">│  logger.py</span><br><span class="line">│  plt.py</span><br><span class="line">│  urt_android.py</span><br><span class="line">│          </span><br><span class="line">├─android</span><br><span class="line">│  │  action_executor.py</span><br><span class="line">│  │  plt_android.py</span><br><span class="line">│  │  screen_capture.py</span><br><span class="line">│  │  tool_base.py</span><br><span class="line">│  │  utils.py</span><br><span class="line">│      </span><br><span class="line">├─pc</span><br><span class="line">│  │  action_executor.py</span><br><span class="line">│  │  plt_pc.py</span><br><span class="line">│  │  screen_capture.py</span><br><span class="line">│  │  tool_base.py</span><br><span class="line">│          </span><br><span class="line">├─web</span><br><span class="line">│  │  action_executor.py</span><br><span class="line">│  │  plt_web.py</span><br><span class="line">│  │  screen_capture.py</span><br><span class="line">│  │  tool_base.py</span><br><span class="line">│</span><br><span class="line">├─configs</span><br><span class="line">│  │  configure.py</span><br><span class="line">│  │  ssh_config.json</span><br><span class="line">│  │</span><br><span class="line">│  ├─android    </span><br><span class="line">│  │</span><br><span class="line">│  ├─web</span><br><span class="line">│          </span><br><span class="line">├─coverages</span><br><span class="line">│              </span><br><span class="line">├─logs   </span><br></pre></td></tr></table></figure>

<p>前端的运行需要一个配置文件作为额外参数（e.g. configs/android/anymemo.json），配置文件结构如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;platform&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>					<span class="comment">// e.g.&quot;android&quot;/&quot;web&quot;/&quot;pc&quot;</span></span><br><span class="line">	<span class="attr">&quot;serial_no&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>				<span class="comment">// 测试使用的设备</span></span><br><span class="line">	<span class="attr">&quot;screen_size&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">,</span>			<span class="comment">// 设备的屏幕尺寸（屏幕截图的分辨率）</span></span><br><span class="line">	<span class="attr">&quot;server_proj_dir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>			<span class="comment">// 服务器上部署的后端项目的路径，e.g.&quot;/root/urt&quot;</span></span><br><span class="line">	<span class="attr">&quot;server_screenshot_dir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>	<span class="comment">// 后端保存屏幕截图的文件夹路径，e.g.&quot;screenshots&quot;</span></span><br><span class="line">	<span class="attr">&quot;local_screenshot_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>	<span class="comment">// 本地保存屏幕截图的文件路径，e.g.&quot;anymemo.png&quot;</span></span><br><span class="line">	<span class="attr">&quot;window_keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">	<span class="attr">&quot;total_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>				<span class="comment">// 测试的总时长，单位为秒</span></span><br><span class="line">	<span class="attr">&quot;banner_height&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;remote_port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>				<span class="comment">// 在服务器上使用的端口号，e.g.&quot;5000&quot;</span></span><br><span class="line">	<span class="attr">&quot;app&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>						<span class="comment">// 被测试应用的基本信息</span></span><br><span class="line">		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>			<span class="comment">//e.g.&quot;budgetwatch&quot;</span></span><br><span class="line">		<span class="attr">&quot;pkg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>			<span class="comment">//e.g.&quot;protect.budgetwatch&quot;</span></span><br><span class="line">		<span class="attr">&quot;main_activity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span>	<span class="comment">//e.g.&quot;protect.budgetwatch.test.InstrumentedActivity&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><blockquote>
<p>此部分内容根据论文初稿整理</p>
</blockquote>
<img src="https://pictures-1312865652.cos.ap-nanjing.myqcloud.com/202208051749222.png" alt="image-20220805174903049" style="zoom:50%;" />

<h4 id="后端的功能主要分为两大模块："><a href="#后端的功能主要分为两大模块：" class="headerlink" title="后端的功能主要分为两大模块："></a>后端的功能主要分为两大模块：</h4><h5 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h5><ul>
<li><p>提取组件和页面布局特征</p>
<ul>
<li>使用 <em>Canny Edge Detection</em> 技术从屏幕截图中提取组件</li>
<li>根据提取到的组件构建一棵组件树来表示页面布局特征</li>
</ul>
</li>
<li><p>组件 Embedding</p>
<ul>
<li>组件图像经过卷积神经网络处理得到一个 4096 维向量，表示组件的图像信息</li>
<li>将屏幕截图的组件位置变为全白而其余地方变为全黑而得到的图片，经过卷积神经网络处理得到一个 4096 维向量，表示组件的位置信息（不使用坐标是为了相对图像信息有足够的权重）</li>
<li>组件图像经过卷积神经网络处理得到一个 14 维独热向量，表示组件的类型</li>
<li>将上述结果拼接而成一个 8206 维的向量，即为 embedding 的结果</li>
<li>以上所说的卷积神经网络，是一个预训练好的用于判断组件类型的 VGG-16 模型，4096 维的向量是其倒数第二层的输出，14 维的向量是其最后一层的输出</li>
</ul>
</li>
<li><p>页面布局 Embedding</p>
<ul>
<li>将树状结构的页面布局转化为字符串</li>
<li>将该字符串使用预训练好的 LSTM 模型处理，输出 512 维的向量，即为 embedding 的结果</li>
</ul>
</li>
<li><p>页面（app 状态）表示</p>
<ul>
<li>计算所有组件的 embedding 向量的平均值，即用一个 8206 维的向量表示所有组件</li>
<li>将组件和页面布局的 embedding 结果连接成 8718 维的向量，表示整个页面（app 状态）</li>
</ul>
</li>
</ul>
<h5 id="强化学习"><a href="#强化学习" class="headerlink" title="强化学习"></a>强化学习</h5><blockquote>
<p>这部分在此没有详细展开说明</p>
</blockquote>
<ul>
<li>动作生成<ul>
<li>用 17 维的独热向量表示动作类型</li>
<li>用 8026 维的向量表示实施动作的组件（没有则做 zero-padding）</li>
<li>用一维向量表示 window size 参数（没有则做 zero-padding）</li>
<li>表示一个动作的向量由上述向量连接而成</li>
</ul>
</li>
<li><em>Q-Network</em> 模型训练<ul>
<li>Q-Network 使用含有四个隐藏层的全连接神经网络</li>
<li>replay-memory 中保存了每次状态转换以及其对应的奖励值，也是训练模型的数据来源</li>
<li>随着测试的进行，模型需要被不断训练和更新</li>
</ul>
</li>
<li>动作决定<ul>
<li>通过 <em>Q-Network</em> 的输出可以得到当前页面下，所有可能动作被执行的优先级</li>
<li>使用 Boltzmann Strategy 决定下一个被执行的动作（避免被困在局部最优解）</li>
</ul>
</li>
</ul>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote>
<p>Web 应用的测试和 PC 端应用的测试本人没有参与，所以以下内容只涉及安卓应用测试</p>
</blockquote>
<h4 id="安卓应用插桩测试方法"><a href="#安卓应用插桩测试方法" class="headerlink" title="安卓应用插桩测试方法"></a>安卓应用插桩测试方法</h4><h5 id="环境准备："><a href="#环境准备：" class="headerlink" title="环境准备："></a>环境准备：</h5><ul>
<li>Java：jdk8（较老的 gradle 无法用 jdk11 运行）和 jdk11（较新的 gradle 需要至少 jdk11 运行）</li>
<li>Gradle：不用额外安装，项目中自带的 gradlew 脚本能在当前自动安装对应版本的 gradle</li>
<li>Android SDK：使用 Android Studio 统一管理，环境变量中正确设置ANDROID_HOME的值</li>
</ul>
<h5 id="构建原项目："><a href="#构建原项目：" class="headerlink" title="构建原项目："></a>构建原项目：</h5><ul>
<li><p>在项目目录下执行如下命令进行构建：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew --no-daemon --stacktrace assembleDebug</span><br></pre></td></tr></table></figure></li>
<li><p><em>–no-daemon</em> 表示 Gradle 守护进程会在命令执行完成后自动退出，不会常驻后台（因为不同应用依赖不同版本的gradle，守护进程没法很好的被复用，无需常驻后台）</p>
</li>
<li><p><em>–stacktrace</em> 表示若报错会打印堆栈信息</p>
</li>
<li><p><em>assembleDebug</em> 表示构建 debug 包</p>
</li>
<li><p>这一步的目的是保证应用本身可正常构建（其构建产物不会被后续使用）</p>
</li>
</ul>
<h5 id="添加插桩代码："><a href="#添加插桩代码：" class="headerlink" title="添加插桩代码："></a>添加插桩代码：</h5><ul>
<li><h6 id="使用-python-脚本一键插桩："><a href="#使用-python-脚本一键插桩：" class="headerlink" title="使用 python 脚本一键插桩："></a>使用 python 脚本一键插桩：</h6>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python instrument.py &#123;x&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注：脚本完成了如下操作</p>
</li>
</ul>
<ol>
<li><p>备份 <em>app</em> 目录下的 <em>build.gradle</em>，并添加一个 <em>apply</em> 语句以应用 <em>jacoco</em> 插件</p>
</li>
<li><p>在 <em>app</em> 目录下添加 <em>jacoco-multi.gradle</em> 或 <em>jacoco-multi-kt.gradle</em>，包含了 <em>jacoco</em> 配置，其中后者是应对 <em>kotlin</em> 项目的配置（该配置文件是一个骨架，后面需要进行修改）</p>
</li>
<li><p>备份并修改 <em>AndroidManifest.xml</em> 配置文件，注册 <em>InstrumentedActiviy</em> 和 <em>JacocoInstrumentation</em> </p>
</li>
<li><p>向源码中加入三个文件：<em>FinishListener</em>、<em>InstrumentedActiviy</em> 和J <em>acocoInstrumentation</em></p>
</li>
</ol>
<p>（上述 <em>app</em> 目录为源码所在目录，一般为 <em>app</em>，也有可能为其它名称，该脚本若未检测到 <em>app</em> 目录，则会提示输入该目录的名称，需要用户自行判别目录并输入，有时源码所在目录就是项目目录，则输入一个点<code>.</code>表示项目目录即可；<em>AndroidManifest.xml</em> 文件默认路径为 <em>app/src/main</em> 下，若检测不到，会要求用户输入其完整路径；源码 <em>java</em> 目录默认为 <em>app/src/main/java</em>，若检测不到，会要求用户输入其完整路径）</p>
<ul>
<li><h6 id="修改-build-和-jacoco-配置："><a href="#修改-build-和-jacoco-配置：" class="headerlink" title="修改 build 和 jacoco 配置："></a>修改 build 和 jacoco 配置：</h6></li>
</ul>
<ol>
<li>检查源码语言是纯 <em>java</em> 还是使用了 <em>kotlin</em>，若使用了 <em>kotlin</em>，检查是否在 <em>app/build.gradle</em> 中 <em>apply</em> 了带 <em>“-kt”</em> 的 <em>jacoco</em> 配置，若没有，则需进行替换</li>
<li>查看 <em>build/intermediates</em> 下的 <em>javac</em> 或 <em>classes</em> 目录，若没有 <em>javac</em> 目录而有 <em>classes</em> 目录，则将 <em>jacoco</em>配置中的 <em>javac</em> 全部替换成 <em>classes</em></li>
<li>（假定上一步是 <em>javac</em> 目录）在 <em>javac</em> 目录下查看 <em>app</em> 构建类型，一般是 <em>xxxDebug</em>，选一个作为测试类型，以后只用该类型的 <em>apk</em>（在 <em>build/outputs/apk</em> 目录下有对应的 <em>apk</em> 文件），修改 <em>jacoco</em> 配置中的 <em>variantName</em> 变量为测试类型的名称</li>
</ol>
<h5 id="构建插桩后的应用："><a href="#构建插桩后的应用：" class="headerlink" title="构建插桩后的应用："></a>构建插桩后的应用：</h5><ul>
<li><p>使用相同的命令构建：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew --no-daemon --stacktrace assembleDebug</span><br></pre></td></tr></table></figure></li>
</ul>
<p>这一步若出现报错，可能有以下几种情况：</p>
<ul>
<li><p><em>java</em> 版本不对（仔细查看报错信息，调整 <em>jdk</em> 版本）</p>
</li>
<li><p><em>jacoco</em> 配置出错，无法设置 <em>outputLocation</em> 属性。这种情况是由于 <em>gradle</em> 版本较低导致的，将<em>jacoco</em> 配置中的 <em>outputLocation</em> 全部替换成 <em>destination</em>，然后将以下三行改掉：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// classDirectories.from = files(...)</span></span><br><span class="line"><span class="comment">// sourceDirectories.from = files(...)</span></span><br><span class="line"><span class="comment">// executionData.from = ecFile</span></span><br><span class="line">classDirectories = files(...)</span><br><span class="line">sourceDirectories = files(...)</span><br><span class="line">executionData = files(ecFile)  <span class="comment">// 注意这里要套一个files</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="安装并运行插桩后的应用："><a href="#安装并运行插桩后的应用：" class="headerlink" title="安装并运行插桩后的应用："></a>安装并运行插桩后的应用：</h5><ul>
<li><p>检查本机是否已经连上用于测试的安卓设备（真机或虚拟机）：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure></li>
<li><p>项目目录下，在用于测试的设备上安装插桩后的应用：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb [-s &#123;设备名称&#125;] install ./app/build/outputs/xxxDebug.apk</span><br></pre></td></tr></table></figure></li>
<li><p>通过源码查看应用的{包名}，并在测试设备上运行安装的应用：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb [-s &#123;设备名称&#125;] shell am instrument &#123;包名&#125;/.test.JacocoInstrumentation</span><br></pre></td></tr></table></figure></li>
</ul>
<p>此时手机会打开插桩后的应用，随便交互几步后，关闭该应用并在后台进程中<strong>杀死</strong>该应用（若不杀死则会不断生成新的覆盖率数据）</p>
<ul>
<li>若插桩后的应用存在打开时闪退的问题，可能是由应用的主题导致的：<ul>
<li>尝试修改 <em>app/src/main/AndroidManifest.xml</em> 中 <em>application</em> 的 <em>android:theme</em> 属性，将原来的例如 <em>AnyMemo.Theme.Dark</em> 修改为 <em>AnyMemo.Theme.Dark</em><em>.NoActionBar</em>**，再重新构建和安装</li>
<li>插桩后出现闪退问题的一般定位方法如下：<ol>
<li>打开一个命令行，使用<code>adb logcat *:D</code>命令跟踪日志</li>
<li>到另一个命令行中启动 <em>instrumentation</em></li>
<li>切换到第一步的命令行，<em>ctrl+c</em> 停止打印，自底向上查找相关的报错信息</li>
</ol>
</li>
</ul>
</li>
</ul>
<h5 id="导出覆盖率数据并生成报告："><a href="#导出覆盖率数据并生成报告：" class="headerlink" title="导出覆盖率数据并生成报告："></a>导出覆盖率数据并生成报告：</h5><ul>
<li><p>覆盖率数据文件被保存在 <em>/data/data/&lt;包名&gt;/files</em> 目录下，通过如下命令导出这些文件：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初次导出需要创建中间目录</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">mkdir</span> /sdcard/coverage</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面run-as后为应用包名</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">run-as org.liberty.android.fantastischmemo</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">mv</span> files/*.ec /sdcard/coverage</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">目标路径为空则默认为当前目录</span></span><br><span class="line">adb pull /sdcard/coverage [目标路径]</span><br></pre></td></tr></table></figure></li>
<li><p>下面将 <em>coverage</em> 目录下所有 <em>.ec</em> 文件移动到该应用的项目目录下的 <em>app/build/jacoco</em> 目录下（没有则创建），在项目目录下使用如下命令生成报告（报告生成在 <em>app/build/reports</em> 目录下）：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew --no-daemon --stacktrace multiJacocoTestReport</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="安卓测试实验流程"><a href="#安卓测试实验流程" class="headerlink" title="安卓测试实验流程"></a>安卓测试实验流程</h4><ul>
<li>在安卓设备上安装插桩后的应用</li>
<li>在前端项目目录下的 <em>configs/android</em>/ 目录下添加被测应用对应的配置信息（xxx.json）</li>
<li>在服务器上启动后端（执行命令：<em>sh run.sh</em>）</li>
<li>在本地启动前端（执行命令：<em>python urt_android xxx.json</em>）</li>
<li>测试设备开始运行被测应用，<em>UniRLTest</em> 测试进行中 …</li>
<li>测试结束，覆盖率数据生成在前端项目目录下的 <em>coverages</em>/xxx/ 目录下</li>
<li>手动生成测试报告（具体步骤已在安卓应用插桩测试中讲过）</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Yoson Ling</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/NJU/"># NJU</a>
                    
                        <a href="/tags/NJU-iSE/"># NJU-iSE</a>
                    
                        <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/"># 软件测试</a>
                    
                        <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/"># 强化学习</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/08/10/NJU-Software-Testing/">南京大学《自动化测试》课程笔记（更新中）</a>
            
            
            <a class="next" rel="next" href="/2022/07/14/NJU-Static-Analysis/">南京大学《软件分析》课程笔记（更新中）</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Yoson Ling | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>